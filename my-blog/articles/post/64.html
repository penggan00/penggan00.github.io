<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VPS产品特惠 - 限时优惠</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --sale-color: #e74c3c;
            --success-color: #2ecc71;
            --light-bg: #f8f9fa;
        }
        
        body {
            background-color: #f5f7fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            padding-bottom: 2rem;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), #1a2530);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .table-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            overflow: hidden;
            margin-bottom: 2rem;
        }
        
        .table thead th {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 1rem;
            font-weight: 600;
        }
        
        .table tbody td {
            padding: 1rem;
            vertical-align: middle;
            border-color: #eee;
        }
        
        .table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .table tbody tr:hover {
            background-color: #eef5ff;
        }
        
        .filter-buttons {
            margin-bottom: 1.5rem;
        }
        
        .refresh-info {
            background-color: #e8f4fc;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .flash-sale {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .price-tag {
            font-weight: 700;
            color: var(--sale-color);
        }
        
        .vps-badge {
            background-color: var(--accent-color);
            color: white;
        }
        
        .sc2-badge {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-deploy {
            background: linear-gradient(to right, var(--success-color), #27ae60);
            border: none;
            border-radius: 6px;
            padding: 0.5rem 1.2rem;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-deploy:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .product-name {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        @media (max-width: 768px) {
            .table-container {
                overflow-x: auto;
            }
            
            .refresh-info {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- 页面头部 -->
    <header class="header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-5 fw-bold">VPS产品特惠</h1>
                    <p class="lead mb-0">高性能虚拟服务器，限时优惠中</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <div class="d-inline-block bg-white text-dark p-2 rounded">
                        <small class="text-muted">下次更新:</small>
                        <span id="countdown" class="fw-bold">60秒</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- 刷新信息 -->
        <div class="refresh-info">
            <div>
                <i class="fas fa-sync-alt me-2"></i>
                <span>数据将每分钟自动刷新，确保您看到最新的优惠信息</span>
            </div>
            <button id="manualRefresh" class="btn btn-sm btn-outline-primary">
                <i class="fas fa-redo me-1"></i> 立即刷新
            </button>
        </div>

        <!-- 筛选按钮 -->
        <div class="filter-buttons">
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-primary active" data-filter="all">全部产品</button>
                <button type="button" class="btn btn-outline-primary" data-filter="vps">VPS</button>
                <button type="button" class="btn btn-outline-primary" data-filter="sc2">SC2</button>
                <button type="button" class="btn btn-outline-primary" data-filter="sale">特价优惠</button>
            </div>
        </div>

        <!-- 表格视图 -->
        <div class="table-container">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th class="text-left">产品名称</th>
                            <th class="text-left">CPU核心</th>
                            <th class="text-left">内存</th>
                            <th class="text-left">硬盘</th>
                            <th class="text-left">流量</th>
                            <th class="text-left">价格</th>
                            <th class="text-left">类型</th>
                            <th class="text-right">操作</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- 表格内容将通过JavaScript动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>VPS服务</h5>
                    <p class="mb-0">提供高性能、可靠的虚拟私有服务器解决方案</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">&copy; 2025 VPS服务商. 保留所有权利.</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // 当前API数据
        let currentApiData = null;

        // 替换部署网址域名 - 完整URL替换
        function replaceDomain(url) {
            // 处理相对路径和绝对路径
            if (url.startsWith('/')) {
                // 相对路径，添加完整域名
                return `https://app.cloudcone.com${url}`;
            } else if (url.includes('www.215155.xyz')) {
                // 绝对路径，直接替换域名
                return url.replace('www.215155.xyz', 'app.cloudcone.com');
            } else if (url.startsWith('http://') || url.startsWith('https://')) {
                // 其他域名，确保使用https
                return url.replace(/^https?:\/\/[^\/]+/, 'https://app.cloudcone.com');
            } else {
                // 默认情况，添加完整域名
                return `https://app.cloudcone.com/${url}`;
            }
        }

        // 模拟API调用 - 在实际应用中替换为真实的API调用
        async function fetchApiData() {
            // 这里模拟API数据的变化
            // 在实际应用中，这里应该是真实的API调用，比如：
            // const response = await fetch('您的API地址');
            // return await response.json();
            
            // 模拟不同的API响应
            const apiResponses = [
                {
                    "status": 1,
                    "message": "Offers retrieved successfully",
                    "__data": {
                        "html": "<tr>\n            <td class='text-left'>BF-25-SSD-VPS-1<\/td>\n            <td class='text-left'>2<\/td>\n            <td class='text-left'>1 GB<\/td>\n            <td class='text-left'>20 GB<\/td>\n            <td class='text-left'>3 TB<\/td>\n            <td class='text-left'><span class='text-danger'>$14.99 \/YR<\/span><\/td>\n            <td class='text-left'><span class='label label-info'>VPS<\/span><\/td>\n            <td class='text-right'><a class='btn btn-success btn-fill btn-sm' target='_blank' href='\/vps\/440\/create?token=BF-25-SSD-VPS-1'>Deploy<\/a><\/td>\n        <\/tr><tr>\n            <td class='text-left'>LA-BF-25-HFS-2-7MHS8H71<\/td>\n            <td class='text-left'>2<\/td>\n            <td class='text-left'>2 GB<\/td>\n            <td class='text-left'>60 GB<\/td>\n            <td class='text-left'>3 TB<\/td>\n            <td class='text-left'><span class='text-danger'>$12.49 \/YR<\/span>&nbsp;&nbsp;<span class='label label-danger label-black-friday heartbeat'>Flash Sale!<\/span><\/td>\n            <td class='text-left'><span class='label label-info'>VPS<\/span><\/td>\n            <td class='text-right'><a class='btn btn-success btn-fill btn-sm' target='_blank' href='\/vps\/456\/create?token=LA-BF-25-HFS-2-7MHS8H71'>Deploy<\/a><\/td>\n        <\/tr><tr>\n            <td class='text-left'>BF-25-SC2-1<\/td>\n            <td class='text-left'>3<\/td>\n            <td class='text-left'>2 GB<\/td>\n            <td class='text-left'>60 GB<\/td>\n            <td class='text-left'>4 TB<\/td>\n            <td class='text-left'><span class='text-danger'>$24.96 \/YR<\/span><\/td>\n            <td class='text-left'><span class='label label-success'>SC2<\/span><\/td><\/td>\n            <td class='text-right'><a class='btn btn-success btn-fill btn-sm' target='_blank' href='\/compute\/1478\/create?token=BF-25-SC2-1'>Deploy<\/a><\/td>\n        <\/tr>",
                        "ttr": 37,
                        "vps_data": {
                            "440": {
                                "id": 440,
                                "name": "BF-25-SSD-VPS-1",
                                "cpu": 2,
                                "ram": "1 GB",
                                "disk": 20,
                                "bandwidth": "3 TB",
                                "usd_price": 14.99,
                                "order_url": "/vps/440/create?token=BF-25-SSD-VPS-1"
                            },
                            "456": {
                                "id": 456,
                                "name": "LA-BF-25-HFS-2-7MHS8H71",
                                "cpu": 2,
                                "ram": "2 GB",
                                "disk": 60,
                                "bandwidth": "3 TB",
                                "usd_price": 12.49,
                                "order_url": "/vps/456/create?token=LA-BF-25-HFS-2-7MHS8H71"
                            }
                        },
                        "sc2_data": {
                            "1478": {
                                "id": 1478,
                                "name": "BF-25-SC2-1",
                                "cpu": 0,
                                "ram": "2 GB",
                                "disk": 60,
                                "bandwidth": "4 TB",
                                "usd_price": 24.96,
                                "order_url": "/compute/1478/create?token=BF-25-SC2-1"
                            }
                        }
                    }
                },
                {
                    "status": 1,
                    "message": "Offers retrieved successfully",
                    "__data": {
                        "html": "<tr>\n            <td class='text-left'>BF-25-SSD-VPS-3<\/td>\n            <td class='text-left'>6<\/td>\n            <td class='text-left'>4 GB<\/td>\n            <td class='text-left'>60 GB<\/td>\n            <td class='text-left'>5 TB<\/td>\n            <td class='text-left'><span class='text-danger'>$39.50 \/YR<\/span><\/td>\n            <td class='text-left'><span class='label label-info'>VPS<\/span><\/td>\n            <td class='text-right'><a class='btn btn-success btn-fill btn-sm' target='_blank' href='\/vps\/442\/create?token=BF-25-SSD-VPS-3'>Deploy<\/a><\/td>\n        <\/tr><tr>\n            <td class='text-left'>LA-BF-25-HFS-2-16JWEQ6S<\/td>\n            <td class='text-left'>3<\/td>\n            <td class='text-left'>2 GB<\/td>\n            <td class='text-left'>30 GB<\/td>\n            <td class='text-left'>4 TB<\/td>\n            <td class='text-left'><span class='text-danger'>$23.99 \/YR<\/span>&nbsp;&nbsp;<span class='label label-danger label-black-friday heartbeat'>Flash Sale!<\/span><\/td>\n            <td class='text-left'><span class='label label-info'>VPS<\/span><\/td>\n            <td class='text-right'><a class='btn btn-success btn-fill btn-sm' target='_blank' href='\/vps\/470\/create?token=LA-BF-25-HFS-2-16JWEQ6S'>Deploy<\/a><\/td>\n        <\/tr><tr>\n            <td class='text-left'>BF-25-SC2-3<\/td>\n            <td class='text-left'>10<\/td>\n            <td class='text-left'>8 GB<\/td>\n            <td class='text-left'>240 GB<\/td>\n            <td class='text-left'>6 TB<\/td>\n            <td class='text-left'><span class='text-danger'>$83.76 \/YR<\/span><\/td>\n            <td class='text-left'><span class='label label-success'>SC2<\/span><\/td><\/td>\n            <td class='text-right'><a class='btn btn-success btn-fill btn-sm' target='_blank' href='\/compute\/1480\/create?token=BF-25-SC2-3'>Deploy<\/a><\/td>\n        <\/tr>",
                        "ttr": 28,
                        "vps_data": {
                            "442": {
                                "id": 442,
                                "name": "BF-25-SSD-VPS-3",
                                "cpu": 6,
                                "ram": "4 GB",
                                "disk": 60,
                                "bandwidth": "5 TB",
                                "usd_price": 39.5,
                                "order_url": "/vps/442/create?token=BF-25-SSD-VPS-3"
                            },
                            "470": {
                                "id": 470,
                                "name": "LA-BF-25-HFS-2-16JWEQ6S",
                                "cpu": 3,
                                "ram": "2 GB",
                                "disk": 30,
                                "bandwidth": "4 TB",
                                "usd_price": 23.99,
                                "order_url": "/vps/470/create?token=LA-BF-25-HFS-2-16JWEQ6S"
                            }
                        },
                        "sc2_data": {
                            "1480": {
                                "id": 1480,
                                "name": "BF-25-SC2-3",
                                "cpu": 0,
                                "ram": "8 GB",
                                "disk": 240,
                                "bandwidth": "6 TB",
                                "usd_price": 83.76,
                                "order_url": "/compute/1480/create?token=BF-25-SC2-3"
                            }
                        }
                    }
                }
            ];
            
            // 随机选择一个API响应来模拟数据变化
            const randomIndex = Math.floor(Math.random() * apiResponses.length);
            return apiResponses[randomIndex];
        }

        // 产品数据提取和格式化
        function extractProducts(data) {
            const products = [];
            
            // 从vps_data提取产品
            if (data.__data.vps_data) {
                for (const id in data.__data.vps_data) {
                    const product = data.__data.vps_data[id];
                    product.type = 'vps';
                    product.hasFlashSale = product.name.includes('LA-BF-25');
                    // 替换部署网址域名
                    product.order_url = replaceDomain(product.order_url);
                    products.push(product);
                }
            }
            
            // 从sc2_data提取产品
            if (data.__data.sc2_data) {
                for (const id in data.__data.sc2_data) {
                    const product = data.__data.sc2_data[id];
                    product.type = 'sc2';
                    product.hasFlashSale = false;
                    // 替换部署网址域名
                    product.order_url = replaceDomain(product.order_url);
                    products.push(product);
                }
            }
            
            return products;
        }

        // 生成表格HTML
        function generateTableHTML(product) {
            const flashSaleBadge = product.hasFlashSale ? 
                '<span class="flash-sale"><i class="fas fa-bolt me-1"></i>限时抢购</span>' : '';
            
            const typeBadge = product.type === 'vps' ? 
                '<span class="badge vps-badge">VPS</span>' : 
                '<span class="badge sc2-badge">SC2</span>';
            
            return `
                <tr data-type="${product.type}" data-sale="${product.hasFlashSale}">
                    <td class="text-left">
                        <span class="product-name">${product.name}</span>
                    </td>
                    <td class="text-left">${product.cpu} 核心</td>
                    <td class="text-left">${product.ram}</td>
                    <td class="text-left">${product.disk} GB</td>
                    <td class="text-left">${product.bandwidth}</td>
                    <td class="text-left">
                        <span class="price-tag">$${product.usd_price}/年</span>
                        ${flashSaleBadge}
                    </td>
                    <td class="text-left">${typeBadge}</td>
                    <td class="text-right">
                        <a href="${product.order_url}" target="_blank" class="btn btn-deploy text-white">
                            <i class="fas fa-rocket me-1"></i>部署
                        </a>
                    </td>
                </tr>
            `;
        }

        // 刷新数据函数
        async function refreshData() {
            console.log('执行自动刷新...');
            
            const countdownElement = document.getElementById('countdown');
            countdownElement.textContent = '更新中...';
            
            try {
                // 获取新的API数据
                const newApiData = await fetchApiData();
                currentApiData = newApiData;
                
                // 重新渲染产品
                renderProducts();
                console.log('数据更新完成');
            } catch (error) {
                console.error('刷新数据失败:', error);
                countdownElement.textContent = '更新失败';
            }
        }

        // 倒计时功能 - 每分钟整刷新
        function startCountdown() {
            const countdownElement = document.getElementById('countdown');
            
            function updateCountdown() {
                const now = new Date();
                const secondsUntilNextMinute = 60 - now.getSeconds();
                
                countdownElement.textContent = `${secondsUntilNextMinute}秒`;
                
                if (secondsUntilNextMinute <= 0) {
                    // 每分钟整点触发刷新
                    refreshData();
                }
            }
            
            // 立即更新一次
            updateCountdown();
            
            // 每秒更新倒计时
            const timer = setInterval(updateCountdown, 1000);
            
            return timer;
        }

        // 渲染产品
        function renderProducts() {
            if (!currentApiData) return;
            
            const products = extractProducts(currentApiData);
            const tableBody = document.getElementById('tableBody');
            
            // 清空现有内容
            tableBody.innerHTML = '';
            
            // 渲染表格视图
            products.forEach(product => {
                tableBody.innerHTML += generateTableHTML(product);
            });
        }

        // 筛选产品
        function filterProducts(filter) {
            const rows = document.querySelectorAll('#tableBody tr');
            
            rows.forEach(row => {
                if (filter === 'all' || 
                    (filter === 'vps' && row.getAttribute('data-type') === 'vps') ||
                    (filter === 'sc2' && row.getAttribute('data-type') === 'sc2') ||
                    (filter === 'sale' && row.getAttribute('data-sale') === 'true')) {
                    row.style.display = 'table-row';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', async function() {
            // 首次加载数据
            try {
                currentApiData = await fetchApiData();
                renderProducts();
            } catch (error) {
                console.error('初始化数据失败:', error);
            }
            
            // 启动每分钟整刷新倒计时
            startCountdown();
            
            // 筛选按钮事件
            document.querySelectorAll('.filter-buttons .btn').forEach(button => {
                button.addEventListener('click', function() {
                    // 移除所有按钮的active类
                    document.querySelectorAll('.filter-buttons .btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // 为当前按钮添加active类
                    this.classList.add('active');
                    
                    // 应用筛选
                    filterProducts(this.getAttribute('data-filter'));
                });
            });
            
            // 手动刷新按钮事件
            document.getElementById('manualRefresh').addEventListener('click', async function() {
                this.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> 刷新中...';
                this.disabled = true;
                
                try {
                    await refreshData();
                } finally {
                    this.innerHTML = '<i class="fas fa-redo me-1"></i> 立即刷新';
                    this.disabled = false;
                }
            });
        });
    </script>
</body>
</html>