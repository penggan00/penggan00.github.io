<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Article...</title>
    <link href="../static/css/blog.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        .article-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.8;
        }
        .article-content img {
            max-width: 100%;
            height: auto;
        }
        .article-content pre {
            background: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <header>
        <div class="header">
            <a href="../index.html">Back to Blog</a>
        </div>
    </header>
    <main>
        <div id="article-content">Loading article...</div>
    </main>

    <script>
        // 从URL获取文章ID
        const params = new URLSearchParams(window.location.search);
        const articleId = params.get('id');
        
        // 加载文章数据
        Promise.all([
            fetch('articles/articles1.js').then(r => r.text()),
            fetch('articles/articles2.js').then(r => r.text())
        ]).then(([data1, data2]) => {
            // 提取文章数组
            const getArticles = (data) => {
                const match = data.match(/const\s+\w+\s*=\s*(\[.*?\])/s);
                return match ? eval(match[1]) : [];
            };
            
            const allArticles = [...getArticles(data1), ...getArticles(data2)];
            const article = allArticles.find(a => {
                const match = a.link.match(/\/(\d+)\.html$/);
                return match && match[1] === articleId;
            });
            
            if(!article) throw new Error('Article not found');
            
            document.title = `${article.title} | peng gan blog`;
            loadArticleContent(article);
        }).catch(err => {
            document.getElementById('article-content').innerHTML = `
                <div class="error">
                    <h2>Error Loading Article</h2>
                    <p>${err.message}</p>
                    <a href="../index.html">Return to Home</a>
                </div>
            `;
        });
        
        // 加载文章内容
        async function loadArticleContent(article) {
            const contentDiv = document.getElementById('article-content');
            const basePath = article.link.replace('.html', '');
            
            try {
                // 优先尝试加载Markdown
                const mdResponse = await fetch(`${basePath}.md`);
                if(mdResponse.ok) {
                    const mdText = await mdResponse.text();
                    contentDiv.innerHTML = marked.parse(mdText);
                    return;
                }
            } catch(e) { /* 忽略错误，尝试HTML */ }
            
            // 回退到HTML
            try {
                const htmlResponse = await fetch(article.link);
                if(htmlResponse.ok) {
                    const htmlText = await htmlResponse.text();
                    contentDiv.innerHTML = htmlText;
                } else {
                    throw new Error('Article content not found');
                }
            } catch(e) {
                throw new Error('Failed to load article content');
            }
        }
    </script>
</body>
</html>